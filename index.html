<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferienangebote Anbieter Berlin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafbfc;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e4e8;
        }

        h1 {
            font-size: 2.2em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1.1em;
            color: #586069;
            margin-bottom: 20px;
        }

        .stats {
            font-size: 0.9em;
            color: #586069;
        }

        .filters {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 180px;
        }

        .filter-group label {
            font-size: 0.9em;
            font-weight: 600;
            color: #24292e;
        }

        .filter-group select, 
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid #d1d5da;
            border-radius: 4px;
            font-size: 0.9em;
            background: white;
        }

        .filter-group select:focus, 
        .filter-group input:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 2px rgba(3, 102, 214, 0.2);
        }

        .clear-btn {
            background: #f6f8fa;
            border: 1px solid #d1d5da;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9em;
            color: #24292e;
        }

        .clear-btn:hover {
            background: #e1e4e8;
        }

        .results-info {
            margin-bottom: 20px;
            padding: 12px 16px;
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 4px;
            font-size: 0.9em;
            color: #0366d6;
        }

        .providers-list {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            overflow: hidden;
        }

        .provider-item {
            padding: 20px;
            border-bottom: 1px solid #e1e4e8;
        }

        .provider-item:last-child {
            border-bottom: none;
        }

        .provider-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 8px;
        }

        .provider-category {
            display: inline-block;
            background: #f1f8ff;
            color: #0366d6;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .provider-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
        }

        .detail-item {
            font-size: 0.9em;
        }

        .detail-label {
            font-weight: 600;
            color: #586069;
            margin-right: 8px;
        }

        .detail-value {
            color: #24292e;
        }

        .provider-website {
            margin-top: 12px;
        }

        .website-link {
            color: #0366d6;
            text-decoration: none;
            font-size: 0.9em;
        }

        .website-link:hover {
            text-decoration: underline;
        }

        .provider-notes {
            background: #fffbdd;
            border: 1px solid #d1d5da;
            border-radius: 4px;
            padding: 12px;
            margin-top: 12px;
            font-size: 0.9em;
            color: #735c0f;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #586069;
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #586069;
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                min-width: auto;
            }
            
            .provider-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ferienangebote Anbieter Berlin</h1>
            <p class="subtitle">Übersicht aller Anbieter von Ferienangeboten für Kinder und Jugendliche in Berlin</p>
            <div class="stats" id="statsInfo">Lade Daten...</div>
        </div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="categoryFilter">Kategorie</label>
                    <select id="categoryFilter">
                        <option value="">Alle Kategorien</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="districtFilter">Bezirk/Standort</label>
                    <select id="districtFilter">
                        <option value="">Alle Bezirke</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="ageFilter">Zielgruppe</label>
                    <select id="ageFilter">
                        <option value="">Alle Altersgruppen</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchFilter">Suche</label>
                    <input type="text" id="searchFilter" placeholder="Anbieter suchen...">
                </div>
                <button class="clear-btn" onclick="clearAllFilters()">Zurücksetzen</button>
            </div>
        </div>

        <div class="results-info" id="resultsInfo">
            Lade Anbieter...
        </div>

        <div class="providers-list" id="providersList">
            <div class="loading">Lade Anbieter...</div>
        </div>
    </div>

    <script>
        let allProviders = [];
        let filteredProviders = [];

        // Configuration - GitHub raw CSV URL
        const CSV_URL = 'https://raw.githubusercontent.com/jakobschumacher/ferienangebote_fuer_kinder/refs/heads/main/anbieter.csv';

        // Load CSV data dynamically
        async function loadCSVData() {
            try {
                document.getElementById('resultsInfo').textContent = 'Lade Daten...';
                
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                parseCSVData(csvText);
                
            } catch (error) {
                console.error('Fehler beim Laden der CSV-Daten:', error);
                document.getElementById('resultsInfo').innerHTML = 
                    `<span style="color: #d73a49;">Fehler beim Laden der Daten: ${error.message}</span>`;
                document.getElementById('providersList').innerHTML = 
                    '<div class="no-results">Die Daten konnten nicht geladen werden. Bitte versuchen Sie es später erneut.</div>';
            }
        }

        // Simple CSV parser
        function parseCSVData(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            const headers = parseCSVLine(lines[0]);
            
            allProviders = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length >= headers.length) {
                    const provider = {};
                    headers.forEach((header, index) => {
                        provider[header] = values[index] || '';
                    });
                    allProviders.push(provider);
                }
            }
            
            initializeFilters();
            filterProviders();
            updateStats();
        }

        // Parse a single CSV line handling quoted fields
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Initialize filter dropdowns
        function initializeFilters() {
            const categories = [...new Set(allProviders.map(p => p['Träger-Kategorie']))].sort();
            const districts = [...new Set(allProviders.map(p => p['Bezirk/Standort']))].sort();
            const ageGroups = [...new Set(allProviders.map(p => p['Zielgruppe']))].sort();

            populateSelect('categoryFilter', categories);
            populateSelect('districtFilter', districts);
            populateSelect('ageFilter', ageGroups);
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            
            // Keep the "All" option and add new options
            select.innerHTML = select.children[0].outerHTML;
            
            options.forEach(option => {
                if (option && option.trim()) {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                }
            });
            
            select.value = currentValue;
        }

        // Filter providers based on current filter values
        function filterProviders() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const districtFilter = document.getElementById('districtFilter').value;
            const ageFilter = document.getElementById('ageFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

            filteredProviders = allProviders.filter(provider => {
                const matchesCategory = !categoryFilter || provider['Träger-Kategorie'] === categoryFilter;
                const matchesDistrict = !districtFilter || provider['Bezirk/Standort'] === districtFilter;
                const matchesAge = !ageFilter || provider['Zielgruppe'] === ageFilter;
                const matchesSearch = !searchFilter || 
                    provider.Anbieter.toLowerCase().includes(searchFilter) ||
                    provider['Angebots-Typ'].toLowerCase().includes(searchFilter) ||
                    provider.Anmerkungen.toLowerCase().includes(searchFilter) ||
                    provider['Träger-Kategorie'].toLowerCase().includes(searchFilter);

                return matchesCategory && matchesDistrict && matchesAge && matchesSearch;
            });

            displayProviders();
            updateResultsInfo();
        }

        // Display filtered providers
        function displayProviders() {
            const list = document.getElementById('providersList');
            
            if (filteredProviders.length === 0) {
                list.innerHTML = '<div class="no-results">Keine Anbieter gefunden. Versuchen Sie andere Filtereinstellungen.</div>';
                return;
            }

            list.innerHTML = filteredProviders.map(provider => {
                const websiteDisplay = provider['Website/Kontakt'] && provider['Website/Kontakt'] !== '-' 
                    ? `<div class="provider-website">
                         <a href="https://${provider['Website/Kontakt'].replace(/^https?:\/\//, '')}" 
                            target="_blank" 
                            class="website-link">
                            → ${provider['Website/Kontakt']}
                         </a>
                       </div>`
                    : '';

                const notesDisplay = provider.Anmerkungen && provider.Anmerkungen !== '-'
                    ? `<div class="provider-notes">
                         ${provider.Anmerkungen}
                       </div>`
                    : '';

                return `
                    <div class="provider-item">
                        <div class="provider-name">${provider.Anbieter}</div>
                        <div class="provider-category">${provider['Träger-Kategorie']}</div>
                        
                        <div class="provider-details">
                            <div class="detail-item">
                                <span class="detail-label">Standort:</span>
                                <span class="detail-value">${provider['Bezirk/Standort']}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Zielgruppe:</span>
                                <span class="detail-value">${provider.Zielgruppe}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Angebots-Typ:</span>
                                <span class="detail-value">${provider['Angebots-Typ']}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Kosten:</span>
                                <span class="detail-value">${provider.Kosten}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Trägerschaft:</span>
                                <span class="detail-value">${provider.Trägerschaft}</span>
                            </div>
                        </div>
                        
                        ${websiteDisplay}
                        ${notesDisplay}
                    </div>
                `;
            }).join('');
        }

        // Update results info
        function updateResultsInfo() {
            const info = document.getElementById('resultsInfo');
            if (filteredProviders.length === allProviders.length) {
                info.textContent = `${allProviders.length} Anbieter insgesamt`;
            } else {
                info.textContent = `${filteredProviders.length} von ${allProviders.length} Anbietern gefunden`;
            }
        }

        // Update statistics
        function updateStats() {
            const categories = new Set(allProviders.map(p => p['Träger-Kategorie']));
            const districts = new Set(allProviders.map(p => p['Bezirk/Standort']));
            
            document.getElementById('statsInfo').textContent = 
                `${allProviders.length} Anbieter • ${categories.size} Kategorien • ${districts.size} Standorte`;
        }

        // Clear all filters
        function clearAllFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('districtFilter').value = '';
            document.getElementById('ageFilter').value = '';
            document.getElementById('searchFilter').value = '';
            filterProviders();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for filters
            document.getElementById('categoryFilter').addEventListener('change', filterProviders);
            document.getElementById('districtFilter').addEventListener('change', filterProviders);
            document.getElementById('ageFilter').addEventListener('change', filterProviders);
            document.getElementById('searchFilter').addEventListener('input', filterProviders);

            // Load initial data
            loadCSVData();
        });
    </script>
</body>
</html>
